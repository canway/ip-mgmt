(window.webpackJsonp=window.webpackJsonp||[]).push([[5],{"3I0w":function(e,t,a){"use strict";a.d(t,"a",(function(){return i})),a.d(t,"b",(function(){return n}));var i=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("bk-dialog",{staticClass:"importDialog",attrs:{title:"导入分配","mask-close":!1,"show-mask":!0,draggable:!1,loading:e.loading,"header-position":"left",width:480,"auto-close":!1},on:{confirm:e.onConfirm},model:{value:e.visible,callback:function(t){e.visible=t},expression:"visible"}},[a("div",{staticClass:"upload-wrapper"},[a("bk-upload",{attrs:{tip:"只允许上传csv,xlsx的文件","with-credentials":!0,"custom-request":e.handleUpload,limit:1,"ext-cls":"upload-wrapper",url:"0",accept:".csv, .xlsx"}}),e._v(" "),a("span",{staticClass:"template-file",on:{click:e.toDownload}},[e._v("模板文件.xlsx")])],1),e._v(" "),e.file?a("p",{staticClass:"file-list-wrapper"},[e._v("\n        "+e._s(e.file.name)+"\n        "),a("i",{staticClass:"bk-icon icon-close",on:{click:e.handleClose}})]):e._e()])},n=[]},EMCV:function(e,t,a){"use strict";a.d(t,"a",(function(){return i})),a.d(t,"b",(function(){return n}));var i=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("bk-sideslider",{attrs:{width:540,"is-show":e.visible,"quick-close":!1},on:{"update:isShow":function(t){e.visible=t},"update:is-show":function(t){e.visible=t}}},[a("div",{attrs:{slot:"header"},slot:"header"},[e._v("\n        新增保留\n    ")]),e._v(" "),a("div",{staticClass:"add-distribute-wrapper",attrs:{slot:"content"},slot:"content"},[a("bk-form",{ref:"reserveForm",attrs:{"label-width":145,model:e.formData,rules:e.rules}},[a("bk-form-item",{attrs:{label:"地址池",required:!0,property:"apply_ip_pool"}},[a("data-select",{attrs:{disabled:!1,placeholder:"请选择地址池",attr:{remote:!0,filterable:!0,searchable:!0,popperAppendToBody:!1,clearable:!0,url:"searchPool",detailUrl:"poolDetail",defaultOption:e.ipPoolDefaultOption}},model:{value:e.formData.apply_ip_pool,callback:function(t){e.$set(e.formData,"apply_ip_pool",t)},expression:"formData.apply_ip_pool"}})],1),e._v(" "),a("bk-form-item",{attrs:{label:"子网",required:!0,property:"ip_net"}},[a("ip-net-select",{attrs:{disabled:!1,placeholder:"请选择子网","form-data":e.formData,attr:{nameKey:"apply_ip_pool",remote:!0,filterable:!0,searchable:!0,popperAppendToBody:!1,clearable:!0,url:"search_ip_net",detailUrl:"poolNetDetail",defaultOption:e.ipNetDefaultOption}},on:{"row-change":e.netSelectChange,change:e.netChange},model:{value:e.formData.ip_net,callback:function(t){e.$set(e.formData,"ip_net",t)},expression:"formData.ip_net"}})],1),e._v(" "),a("bk-form-item",{attrs:{label:"待分配IP",required:!0,property:"ips"}},[a("bk-input",{attrs:{type:"textarea",rows:6,placeholder:"多个不连续IP用英文逗号隔开，连续IP中间用横杠连接，如：1.1.1.1,2.2.2.2,3.3.3.3-3.3.3.10（IP必须在这个子网内，点击确定将进行检测）"},model:{value:e.formData.ips,callback:function(t){e.$set(e.formData,"ips",t)},expression:"formData.ips"}})],1),e._v(" "),a("bk-form-item",{attrs:{label:"云区域",property:"vlan_id"}},[a("bk-input",{attrs:{disabled:!0,placeholder:"请输入云区域"},model:{value:e.formData.vlan_id,callback:function(t){e.$set(e.formData,"vlan_id",t)},expression:"formData.vlan_id"}})],1),e._v(" "),a("bk-form-item",{attrs:{label:"网关",property:"gateway"}},[a("bk-input",{attrs:{disabled:!0,placeholder:"请输入网关"},model:{value:e.formData.gateway,callback:function(t){e.$set(e.formData,"gateway",t)},expression:"formData.gateway"}})],1),e._v(" "),a("bk-form-item",{attrs:{label:"DNS服务器",property:"dns"}},[a("bk-input",{attrs:{disabled:!0,placeholder:"请输入DNS服务器"},model:{value:e.formData.dns,callback:function(t){e.$set(e.formData,"dns",t)},expression:"formData.dns"}})],1),e._v(" "),a("bk-form-item",{attrs:{label:"VLAN ID",property:"vlan_id"}},[a("bk-input",{attrs:{disabled:!0,placeholder:"请输入VLAN ID"},model:{value:e.formData.vlan_id,callback:function(t){e.$set(e.formData,"vlan_id",t)},expression:"formData.vlan_id"}})],1),e._v(" "),a("bk-form-item",{attrs:{label:"备注",property:"reason"}},[a("bk-input",{attrs:{type:"textarea",placeholder:"请输入"},model:{value:e.formData.reason,callback:function(t){e.$set(e.formData,"reason",t)},expression:"formData.reason"}})],1)],1)],1),e._v(" "),a("div",{attrs:{slot:"footer"},slot:"footer"},[a("bk-button",{staticStyle:{"margin-left":"24px"},attrs:{"ext-cls":"mr5",theme:"primary",title:"保存",loading:e.isConfirm},on:{click:function(t){return t.stopPropagation(),t.preventDefault(),e.submitData.apply(null,arguments)}}},[e._v("\n            确定\n        ")]),e._v(" "),a("bk-button",{attrs:{"ext-cls":"mr5",theme:"default",title:"取消"},on:{click:function(t){e.visible=!1}}},[e._v("\n            取消\n        ")])],1)])},n=[]},HjNQ:function(e,t,a){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=s(a("omC7")),n=s(a("uapl")),r=s(a("ZZio"));function s(e){return e&&e.__esModule?e:{default:e}}t.default={name:"add-distribute",components:{dataSelect:n.default,ipNetSelect:r.default},data:function(){return{visible:!1,rules:{apply_ip_pool:[{required:!0,message:"必填项",trigger:"blur"}],ip_net:[{required:!0,message:"必填项",trigger:"blur"}],ips:[{required:!0,message:"必填项",trigger:"blur"}],apply_reason:[{required:!0,message:"必填项",trigger:"blur"}]},formData:{apply_ip_pool:"",ip_net:"",ips:"",reason:""},isConfirm:!1,ipNetDefaultOption:{},ipPoolDefaultOption:{}}},methods:{showDialog:function(e){var t=this;if(e){this.ipNetDefaultOption={id:e.ip_net,ip_net:e.ip_net_name},this.ipPoolDefaultOption={id:e.ip_pool_id,name:e.ip_pool};var a=[];e.ipOption.forEach((function(e){a.push(e.ip)})),this.formData={apply_ip_pool:e.ip_pool_id,ip_net:e.ip_net,ips:a.join(","),reason:""}}else this.formData={apply_ip_pool:"",ip_net:"",ips:"",reason:""};this.netSelectChange(),this.$nextTick((function(){t.settingPosition()})),this.visible=!0},netSelectChange:function(e){var t=this,a=["bk_cloud_id","gateway","dns","vlan_id"];if(e)return a.forEach((function(a){t.formData[a]=e[a]})),!1;a.forEach((function(e){t.formData[e]=""}))},netChange:function(){this.$set(this.formData,"ips","")},submitData:function(){var e=this;this.isConfirm=!0,this.$refs.reserveForm.validate().then((function(t){var a=JSON.parse((0,i.default)(e.formData));e.$api.ip_check({ip_net:a.ip_net,ips:a.ips.split(",")}).then((function(t){t.result?(e._successMessage("保留成功"),e.$api.ip_reserve({ip_net:a.ip_net,remark:a.reason,ips:a.ips.split(","),is_reserve:!0}).then((function(t){t.result&&(e.$emit("ok-confirm",!0),e.visible=!1)}))):e._errorMessage(t.message)})).finally((function(){e.isConfirm=!1}))}),(function(t){e.isConfirm=!1}))}}}},IQmW:function(e,t,a){"use strict";a.r(t);var i=a("3I0w"),n=a("eB9z");for(var r in n)["default"].indexOf(r)<0&&function(e){a.d(t,e,(function(){return n[e]}))}(r);a("uKJ2");var s=a("y6gh"),o=Object(s.a)(n.default,i.a,i.b,!1,null,"073b88fa",null);t.default=o.exports},JcIH:function(e,t,a){},MkCj:function(e,t,a){"use strict";a.r(t);var i=a("dGK7"),n=a("ONrY");for(var r in n)["default"].indexOf(r)<0&&function(e){a.d(t,e,(function(){return n[e]}))}(r);a("JcIH");var s=a("y6gh"),o=Object(s.a)(n.default,i.a,i.b,!1,null,"d9e70842",null);t.default=o.exports},ONrY:function(e,t,a){"use strict";a.r(t);var i=a("WMaf"),n=a.n(i);for(var r in i)["default"].indexOf(r)<0&&function(e){a.d(t,e,(function(){return i[e]}))}(r);t.default=n.a},WMaf:function(e,t,a){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=b(a("EPZ6")),n=b(a("cLjf")),r=b(a("bS4n")),s=b(a("hDQ3")),o=b(a("unDg")),l=b(a("GEkW")),c=b(a("DcpZ")),d=b(a("JnIg")),u=b(a("xiJ/")),p=b(a("lZ0v")),f=b(a("awAS")),h=b(a("IQmW")),m=b(a("egfQ"));function b(e){return e&&e.__esModule?e:{default:e}}t.default={name:"home",components:{advancedSearch:l.default,commonTable:d.default,searchInput:c.default,batchModify:u.default,batchRecycle:p.default,addDistribute:f.default,importDialog:h.default,addReserve:m.default},data:function(){return{loading:!1,searchValue:"",datas:[],columns:[{label:"状态检测",key:"operation",width:"100px",scopedSlots:{customRender:"operation"}}],checking:!1,statusColorObj:{2:"#91B6F5",1:"#7ED4B2",4:"#9DB1CE",3:"#E9B76E"},statusObj:{1:"未分配",2:"已分配",3:"待回收",4:"已回收"},selectedRows:[],pagination:{current:1,count:3,limit:10},sort:{prop:"create_at",order:"descending"},settingsFields:[{label:"IP地址",key:"ip",disabled:!0,attr:{minWidth:"125px"},conditionAttr:{widget:"input",placeholder:"请输入IP地址",attr:{clearable:!0}}},{label:"地址池名称",key:"ip_pool",disabled:!0,attr:{minWidth:"120px"},sortable:!0,conditionAttr:{widget:"data-select",label:"地址池",custom:!0,name:"ip_pool",placeholder:"请输入地址池",attr:{clearable:!0,remote:!0,filterable:!0,searchable:!0,popperAppendToBody:!1,url:"searchPool",detailUrl:"poolDetail",initFlag:!0}}},{label:"IP子网",key:"ip_net_name",disabled:!0,attr:{minWidth:"125px"},conditionAttr:{widget:"ip-net-select",placeholder:"请选择子网",label:"子网",custom:!0,name:"ip_net",attr:{nameKey:"ip_pool",remote:!0,filterable:!0,searchable:!0,popperAppendToBody:!1,clearable:!0,url:"search_ip_net",detailUrl:"poolNetDetail",initFlag:!0}}},{label:"云区域",key:"bk_cloud_id",align:"right",conditionAttr:{widget:"input",placeholder:"请输入云区域",attr:{clearable:!0}}},{label:"网关",key:"gateway",attr:{minWidth:"125px"},conditionAttr:{widget:"input",placeholder:"请输入网关",attr:{clearable:!0}}},{label:"DNS服务器",key:"dns",attr:{minWidth:"125px"},conditionAttr:{widget:"input",label:"DNS",placeholder:"请输入DNS",attr:{clearable:!0}}},{label:"分配状态",key:"allocate_status",scopedSlots:{customRender:"status"},conditionAttr:{widget:"data-select",custom:!0,placeholder:"请选择相关数据",size:"small",defaultValue:[],attr:{searchable:!1,multiple:!1,popperAppendToBody:!1,clearable:!0,options:[{id:"1",name:"未分配"},{id:"2",name:"已分配"},{id:"3",name:"待回收"},{id:"4",name:"已回收"}]}}},{label:"在线状态",key:"online_status",scopedSlots:{customRender:"online_status"},conditionAttr:{widget:"data-select",custom:!0,placeholder:"请选择相关数据",size:"small",defaultValue:[],attr:{searchable:!1,multiple:!1,popperAppendToBody:!1,clearable:!0,options:[{id:1,name:"在线"},{id:2,name:"离线"}]}}},{label:"保留状态",key:"reserve_status",scopedSlots:{customRender:"reserve_status"},conditionAttr:{widget:"data-select",custom:!0,placeholder:"请选择相关数据",size:"small",defaultValue:[],attr:{searchable:!1,multiple:!1,popperAppendToBody:!1,clearable:!0,options:[{id:1,name:"保留"},{id:2,name:"未保留"}]}}},{label:"业务系统",key:"business_system",attr:{minWidth:"125px"},conditionAttr:{widget:"input",placeholder:"请输入业务系统",attr:{clearable:!0}}},{label:"运维人员",key:"member",attr:{minWidth:"125px"},conditionAttr:{widget:"input",placeholder:"请输入运维人员",attr:{clearable:!0}}},{label:"分配时间",key:"allocate_at",align:"left",attr:{minWidth:"130px"},conditionAttr:{widget:"date-picker",placeholder:"请选择...",attr:{style:{width:"100%"},transfer:!0,clearable:!0,type:"daterange",shortcutClose:!0,useShortcutText:!1,shortcuts:[{text:"今天",value:function(){var e=new Date;return[new Date,e]}},{text:"近7天",value:function(){var e=new Date,t=new Date;return t.setTime(t.getTime()-6048e5),[t,e]}},{text:"近15天",value:function(){var e=new Date,t=new Date;return t.setTime(t.getTime()-1296e6),[t,e]}},{text:"近30天",value:function(){var e=new Date,t=new Date;return t.setTime(t.getTime()-2592e6),[t,e]}}]}}},{label:"离线时间",key:"offline_at",align:"left",attr:{minWidth:"130px"},conditionAttr:{widget:"date-picker",placeholder:"请选择...",attr:{style:{width:"100%"},transfer:!0,clearable:!0,type:"daterange",shortcutClose:!0,useShortcutText:!1,shortcuts:[{text:"今天",value:function(){var e=new Date;return[new Date,e]}},{text:"近7天",value:function(){var e=new Date,t=new Date;return t.setTime(t.getTime()-6048e5),[t,e]}},{text:"近15天",value:function(){var e=new Date,t=new Date;return t.setTime(t.getTime()-1296e6),[t,e]}},{text:"近30天",value:function(){var e=new Date,t=new Date;return t.setTime(t.getTime()-2592e6),[t,e]}}]}}},{label:"描述",key:"description",align:"left",sortable:!0,attr:{minWidth:"130px",showOverflowTooltip:!0},conditionAttr:{widget:"input",placeholder:"请输入描述",attr:{clearable:!0}}},{label:"过期时间",key:"expired_at",align:"left",attr:{minWidth:"130px"},conditionAttr:{widget:"date-picker",placeholder:"请选择...",attr:{style:{width:"100%"},transfer:!0,clearable:!0,type:"daterange",shortcutClose:!0,useShortcutText:!1,shortcuts:[{text:"今天",value:function(){var e=new Date;return[new Date,e]}},{text:"近7天",value:function(){var e=new Date,t=new Date;return t.setTime(t.getTime()-6048e5),[t,e]}},{text:"近15天",value:function(){var e=new Date,t=new Date;return t.setTime(t.getTime()-1296e6),[t,e]}},{text:"近30天",value:function(){var e=new Date,t=new Date;return t.setTime(t.getTime()-2592e6),[t,e]}}]}}},{label:"扫描时间",key:"scan_at",align:"left",attr:{minWidth:"130px"},conditionAttr:{widget:"date-picker",placeholder:"请选择...",attr:{style:{width:"100%"},transfer:!0,clearable:!0,type:"daterange",shortcutClose:!0,useShortcutText:!1,shortcuts:[{text:"今天",value:function(){var e=new Date;return[new Date,e]}},{text:"近7天",value:function(){var e=new Date,t=new Date;return t.setTime(t.getTime()-6048e5),[t,e]}},{text:"近15天",value:function(){var e=new Date,t=new Date;return t.setTime(t.getTime()-1296e6),[t,e]}},{text:"近30天",value:function(){var e=new Date,t=new Date;return t.setTime(t.getTime()-2592e6),[t,e]}}]}}},{label:"备注",key:"remark",attr:{minWidth:"125px"},conditionAttr:{widget:"input",placeholder:"请输入备注",attr:{clearable:!0}}}],formWidgets:[],formData:{gateway:"",dns:"",offline_at:"",reserve_status:1,description:""},isConfirm:!1,batchWidgets:[{widget:"input",name:"gateway",label:"网关",required:!1,placeholder:"请输入网关",attr:{clearable:!0},disabled:!0},{widget:"input",name:"dns",label:"DNS服务器",required:!1,placeholder:"请输入DNS服务器",attr:{clearable:!0},disabled:!0},{widget:"date-picker",name:"offline_at",label:"过期时间",placeholder:"请选择...",attr:{style:{width:"100%"},transfer:!0,clearable:!0},disabled:!0},{widget:"data-select",name:"reserve_status",label:"保留状态",custom:!0,placeholder:"请选择相关数据",size:"small",attr:{searchable:!1,multiple:!1,popperAppendToBody:!1,clearable:!0,options:[{id:1,name:"保留"},{id:2,name:"未保留"}]},disabled:!0},{widget:"input",name:"business_system",label:"业务系统",required:!1,placeholder:"请输入业务系统",attr:{clearable:!0},disabled:!0},{widget:"input",name:"description",label:"描述",required:!1,placeholder:"请输入描述",attr:{clearable:!0,type:"textarea"},disabled:!0}],batchModifyVisible:!1,customAttr:[],searchParams:{},isDropdownShow:!1,batchCheckDisable:!1,customAttrNames:[]}},watch:{searchValue:function(e){e||this.onSearch()}},created:function(){var e=this.$store.state.product.tableColumns.ip;e.length>0?this.columns=[].concat((0,o.default)(e)):this.columns=this.settingsFields.slice(0,8).concat(this.columns)},mounted:function(){this.fetchData(),this.getCustomAttr()},methods:{fetchData:function(){var e=this,t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return(0,s.default)(n.default.mark((function a(){var i;return n.default.wrap((function(a){for(;;)switch(a.prev=a.next){case 0:return e.loading=!0,a.prev=1,a.next=4,e.$api.search_ip((0,r.default)({},e.searchParams,t,{page:e.pagination.current,page_size:e.pagination.limit,sort:"ascending"===e.sort.order?e.getProp():"-"+e.getProp()}));case 4:(i=a.sent).result?(e.pagination.count=i.data.count,e.datas=i.data.results||[],e.datas.forEach((function(e){e.expired_at=e.expired_at&&e.expired_at.split(" ")[0],e.custom_attr.forEach((function(t){e[t.name]=t.value}))}))):e._errorMessage(i.message);case 6:return a.prev=6,e.loading=!1,a.finish(6);case 9:case"end":return a.stop()}}),a,e,[[1,,6,9]])})))()},getProp:function(){return"ip_pool"===this.sort.prop?"ip_net__ip_pool__name":this.sort.prop},getCustomAttr:function(){var e=this;return(0,s.default)(n.default.mark((function t(){var a,i,s;return n.default.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,e.$api.searchCustom({type:"ips"});case 2:(a=t.sent).result?(e.customAttr=a.data.results,a.data.results.forEach((function(t){e.settingsFields.push({label:t.display_name,key:t.name,align:"left",attr:{minWidth:"100px"},conditionAttr:{widget:"input",placeholder:"请输入"+t.display_name,attr:{clearable:!0}}}),e.batchWidgets.push({widget:"input",name:t.name,label:t.display_name,required:!1,placeholder:"请输入"+t.display_name,attr:{clearable:!0},disabled:!0}),e.customAttrNames.push(t.name)})),i=e.columns.map((function(e){return(0,r.default)({name:e.key,label:e.label},e.conditionAttr)})),s=["operation"].concat((0,o.default)(e.customAttrNames)),e.formWidgets=i.filter((function(e){return!s.includes(e.name)}))):e.customAttr=[];case 4:case"end":return t.stop()}}),t,e)})))()},selectChange:function(e){this.selectedRows=e},handlePageChange:function(e){this.pagination.current=e,this.fetchData()},limitChange:function(e){this.pagination.current=1,this.pagination.limit=e,this.fetchData()},onSearch:function(e){this.searchParams={search:e},this.pagination.current=1,this.fetchData({search:e})},handleAdvancedSearch:function(e){var t=this;(0,i.default)(e).forEach((function(a){["allocate_at","offline_at","expired_at","scan_at"].includes(a)&&(e[a][0]&&e[a][1]?(e[a+"__gte"]=t.$moment(e[a][0]).format("YYYY-MM-DD HH:mm:ss"),e[a+"__lte"]=t.$moment(e[a][1]).format("YYYY-MM-DD HH:mm:ss"),delete e[a]):delete e[a]),e[a]||0===e[a]||delete e[a],"online_status"===a&&(e[a]=1===e[a]),"reserve_status"===a&&(e[a]=1===e[a])})),this.pagination.current=1,this.searchParams=(0,r.default)({},e),this.fetchData((0,r.default)({},e))},handleSettingChange:function(e,t){var a=["operation"].concat((0,o.default)(this.customAttrNames));this.formWidgets=e.filter((function(e){return!a.includes(e.name)})),this.$store.commit("setTableColumns",{column:t,key:"ip"})},handleSortChange:function(e){e.column;var t=e.prop,a=e.order;this.sort.prop=t,this.sort.order=a,this.fetchData()},batchModify:function(){if(0===this.selectedRows.length)return this._warnMessage("请先选择要修改的IP地址"),!1;this.batchModifyVisible=!0,this.formData={gateway:"",dns:"",offline_at:"",reserve_status:1,description:""}},toComfirmModify:function(e){var t=this;return(0,s.default)(n.default.mark((function a(){var i,s;return n.default.wrap((function(a){for(;;)switch(a.prev=a.next){case 0:if(t.isConfirm=!0,!e.gateway||t.isValidateGateway(e.gateway)){a.next=5;break}return t._warnMessage("请输入正确的网关"),setTimeout((function(){t.isConfirm=!1}),500),a.abrupt("return",!1);case 5:if(!e.dns||t.isValidateGateway(e.dns)){a.next=9;break}return t._warnMessage("请输入正确的DNS服务器"),setTimeout((function(){t.isConfirm=!1}),500),a.abrupt("return",!1);case 9:return e.offline_at&&(e.offline_at=t.$moment(e.offline_at).format("YYYY-MM-DD hh:mm:ss")),e.reserve_status&&(e.reserve_status=1===e.reserve_status),i=[],t.selectedRows.forEach((function(e){i.push(e.id)})),a.prev=13,a.next=16,t.$api.ip_batch_update((0,r.default)({selected_ids:i},e));case 16:(s=a.sent).result?(t._successMessage("更新成功"),t.batchModifyVisible=!1,t.fetchData()):(t._errorMessage(s.message),t.batchModifyVisible=!1);case 18:return a.prev=18,t.isConfirm=!1,a.finish(18);case 21:case"end":return a.stop()}}),a,t,[[13,,18,21]])})))()},isValidateGateway:function(e){return/^(\d{1,2}|1\d\d|2[0-4]\d|25[0-5])\.(\d{1,2}|1\d\d|2[0-4]\d|25[0-5])\.(\d{1,2}|1\d\d|2[0-4]\d|25[0-5])\.(\d{1,2}|1\d\d|2[0-4]\d|25[0-5])$/.test(e)},handleRecycle:function(){if(0===this.selectedRows.length)return this._warnMessage("请先选择要回收的IP地址"),!1;for(var e=0;e<this.selectedRows.length;e++)if("1"===this.selectedRows[e].allocate_status)return this._warnMessage("存在未分配的IP地址"),!1;this.$refs.batchRecycle.showDialog()},handleVisible:function(e){if(this.selectedRows.length>0){for(var t=this.selectedRows[0],a=[],i=0;i<this.selectedRows.length;i++){if(this.selectedRows[i].reserve_status&&"reserveDialog"===e)return void this._warnMessage("存在已保留的IP地址");if("1"!==this.selectedRows[i].allocate_status&&"distributeDialog"===e)return void this._warnMessage("只能操作未分配的IP地址");if(this.selectedRows[i].ip_pool!==t.ip_pool||this.selectedRows[i].ip_net_name!==t.ip_net_name)return void this._warnMessage("IP必须同一地址池和子网");a.push({id:this.selectedRows[i].id,ip:this.selectedRows[i].ip})}t.ipOption=a,this.$refs[e].showDialog(t)}else this.$refs[e].showDialog()},toExport:function(){var e=this,t="";(0,i.default)(this.searchParams).forEach((function(a){t=t+"&"+a+"="+e.searchParams[a]}));var a=window.siteUrl+"ip/export_excel/?page=1&page_size=-1"+t;window.open(a)},ipCheck:function(e){var t=this;this.$set(e,"checking",!0),this.$api.status_check({ips:e.ip}).then((function(e){e.result?(t._successMessage("检测成功"),t.fetchData()):t._warnMessage("检测失败，请稍后重试")}))},batchCheck:function(){var e=this,t=[];this.batchCheckDisable=!0,this.selectedRows.length>0?(this.selectedRows.forEach((function(e){t.push(e.ip)})),this.$api.status_check({ips:t.join(",")}).then((function(t){t.result?(e._successMessage("检测成功"),e.batchCheckDisable=!1,e.fetchData()):e._warnMessage("检测失败，请稍后重试")}),(function(){e.batchCheckDisable=!1}))):(this.batchCheckDisable=!1,this._warnMessage("请先选择要检测的IP地址"))},dropdownShow:function(){this.isDropdownShow=!0},dropdownHide:function(){this.isDropdownShow=!1},triggerHandler:function(){this.$refs.dropdown.hide()}}}},dGK7:function(e,t,a){"use strict";a.d(t,"a",(function(){return i})),a.d(t,"b",(function(){return n}));var i=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",{staticClass:"table—wrapper"},[a("div",{staticClass:"header-table-operation"},[a("search-input",{attrs:{placeholder:"请输入关键字搜索"},on:{search:e.onSearch},model:{value:e.searchValue,callback:function(t){e.searchValue=t},expression:"searchValue"}}),e._v(" "),a("advanced-search",{attrs:{"form-widgets":e.formWidgets},on:{submit:e.handleAdvancedSearch}}),e._v(" "),a("div",{staticClass:"operation-container"},[a("div",[e.datas.length>0?a("bk-button",{attrs:{title:"导出"},on:{click:e.toExport}},[e._v("\n                    导出\n                ")]):e._e(),e._v(" "),a("bk-button",{attrs:{title:"导出",disabled:e.batchCheckDisable},on:{click:e.batchCheck}},[e._v("\n                    批量检测\n                ")]),e._v(" "),a("bk-button",{attrs:{title:"导出"},on:{click:e.batchModify}},[e._v("\n                    批量修改\n                ")]),e._v(" "),a("bk-dropdown-menu",{ref:"dropdown",attrs:{trigger:"click"},on:{show:e.dropdownShow,hide:e.dropdownHide}},[a("div",{staticClass:"dropdown-trigger-btn",staticStyle:{"padding-left":"19px"},attrs:{slot:"dropdown-trigger"},slot:"dropdown-trigger"},[a("span",[e._v("更多操作")]),e._v(" "),a("i",{class:["bk-icon icon-angle-down",{"icon-flip":e.isDropdownShow}]})]),e._v(" "),a("ul",{staticClass:"bk-dropdown-list",attrs:{slot:"dropdown-content"},slot:"dropdown-content"},[a("li",[a("a",{attrs:{href:"javascript:;"},on:{click:e.handleRecycle}},[e._v("批量回收")])]),e._v(" "),a("li",[a("a",{attrs:{href:"javascript:;"},on:{click:function(t){return e.handleVisible("importDialog")}}},[e._v("导入分配")])]),e._v(" "),a("li",[a("a",{attrs:{href:"javascript:;"},on:{click:function(t){return e.handleVisible("distributeDialog")}}},[e._v("新增分配")])]),e._v(" "),a("li",[a("a",{attrs:{href:"javascript:;"},on:{click:function(t){return e.handleVisible("reserveDialog")}}},[e._v("新增保留")])])])])],1)])],1),e._v(" "),a("div",{directives:[{name:"bkloading",rawName:"v-bkloading",value:{isLoading:e.loading,zIndex:10},expression:"{ isLoading: loading, zIndex: 10 }"}]},[a("common-table",{attrs:{data:e.datas,columns:e.columns,"select-column":{visible:!0,fixed:!0},"order-column":{visible:!1,fixed:!1},"settings-fields":e.settingsFields,pagination:e.pagination},on:{"selection-change":e.selectChange,handleSettingChange:e.handleSettingChange,"sort-change":e.handleSortChange,"page-change":e.handlePageChange,"page-limit-change":e.limitChange},scopedSlots:e._u([{key:"status",fn:function(t){return[a("span",{staticClass:"radius-tip",style:{background:e.statusColorObj[t.scope.allocate_status]}}),e._v("\n                "+e._s(e.statusObj[t.scope.allocate_status])+"\n            ")]}},{key:"online_status",fn:function(t){return[a("span",{style:{color:t.scope.online_status?"#14A568":"#FF5656"}},[e._v("\n                    "+e._s(t.scope.online_status?"在线":"离线")+"\n                ")])]}},{key:"reserve_status",fn:function(t){return[a("span",{style:{color:t.scope.reserve_status?"#14A568":"#FF5656"}},[e._v("\n                    "+e._s(t.scope.reserve_status?"保留":"未保留")+"\n                ")])]}},{key:"operation",fn:function(t){return[a("bk-button",{staticClass:"mr10",attrs:{theme:"primary",text:"",disabled:t.scope.checking},on:{click:function(a){return e.ipCheck(t.scope)}}},[e._v("立即检测\n                ")])]}}])})],1),e._v(" "),a("batch-modify",{attrs:{"is-edit":!0,"form-data":e.formData,"form-widgets":e.batchWidgets,title:"IP地址批量修改","submit-loading":e.isConfirm},on:{submit:e.toComfirmModify},model:{value:e.batchModifyVisible,callback:function(t){e.batchModifyVisible=t},expression:"batchModifyVisible"}}),e._v(" "),a("batch-recycle",{ref:"batchRecycle",attrs:{selected:e.selectedRows},on:{"ok-recycle":e.fetchData}}),e._v(" "),a("import-dialog",{ref:"importDialog",on:{"ok-confirm":e.fetchData}}),e._v(" "),a("add-distribute",{ref:"distributeDialog",on:{"ok-confirm":e.fetchData}}),e._v(" "),a("add-reserve",{ref:"reserveDialog",on:{"ok-confirm":e.fetchData}})],1)},n=[]},eB9z:function(e,t,a){"use strict";a.r(t);var i=a("hW5l"),n=a.n(i);for(var r in i)["default"].indexOf(r)<0&&function(e){a.d(t,e,(function(){return i[e]}))}(r);t.default=n.a},egfQ:function(e,t,a){"use strict";a.r(t);var i=a("EMCV"),n=a("fIyS");for(var r in n)["default"].indexOf(r)<0&&function(e){a.d(t,e,(function(){return n[e]}))}(r);a("fnj8");var s=a("y6gh"),o=Object(s.a)(n.default,i.a,i.b,!1,null,"79224534",null);t.default=o.exports},fIyS:function(e,t,a){"use strict";a.r(t);var i=a("HjNQ"),n=a.n(i);for(var r in i)["default"].indexOf(r)<0&&function(e){a.d(t,e,(function(){return i[e]}))}(r);t.default=n.a},fnj8:function(e,t,a){},hW5l:function(e,t,a){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default={name:"import-ips",data:function(){return{visible:!1,file:null,loading:!1}},methods:{showDialog:function(){this.visible=!0},onConfirm:function(){var e=this;if(this.loading=!0,!this.file)return this._warnMessage("请先选择文件再上传"),this.loading=!1,!1;var t=new FormData;t.append("file",this.file),this.$api.ip_allocation(t).then((function(t){t.result?(e.$emit("ok-confirm",!0),e._successMessage("导入成功"),e.visible=!1):(e._errorMessage(t.message),e.visible=!1)})).catch((function(){e._errorMessage("导入失败,请稍后再试")})).finally((function(){e.loading=!1}))},handleUpload:function(e){this.file=e.fileObj.origin},handleClose:function(){this.file=""},toDownload:function(){var e=window.siteUrl+"ip/download_template/";window.open(e)}}}},uKJ2:function(e,t,a){}}]);
//# sourceMappingURL=5.13a9f7abceeb9aabbba5.js.map
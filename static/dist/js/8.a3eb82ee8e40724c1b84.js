(window.webpackJsonp=window.webpackJsonp||[]).push([[8],{F0BY:function(t,e,a){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var n=m(a("EPZ6")),r=m(a("cLjf")),i=m(a("hDQ3")),o=m(a("bS4n")),s=m(a("unDg")),l=m(a("DcpZ")),u=m(a("JnIg")),c=m(a("GEkW")),d=m(a("J5TV")),f=m(a("xdyK"));function m(t){return t&&t.__esModule?t:{default:t}}e.default={name:"home",components:{commonTable:u.default,searchInput:l.default,advancedSearch:c.default,editAddressPool:d.default,importDialog:f.default},data:function(){return{loading:!1,importLoading:!1,searchValue:"",datas:[],columns:[{label:"操作",key:"operation",width:"100px",scopedSlots:{customRender:"operation"}}],pagination:{current:1,count:3,limit:10},sort:{prop:"create_at",order:"descending"},formWidgets:[],settingsFields:[{label:"地址池名称",key:"ip_pool_name",align:"left",sortable:!0,attr:{minWidth:"110px"},conditionAttr:{widget:"data-select",label:"地址池",custom:!0,name:"ip_pool",placeholder:"请输入地址池",attr:{clearable:!0,remote:!0,filterable:!0,searchable:!0,popperAppendToBody:!1,url:"searchPool",detailUrl:"poolDetail",initFlag:!0}}},{label:"ip子网",key:"ip_net",align:"left",attr:{minWidth:"150px"},conditionAttr:{widget:"input",placeholder:"请输入ip子网",attr:{clearable:!0}}},{label:"云区域",key:"bk_cloud_id",align:"right",attr:{minWidth:"90px"},conditionAttr:{widget:"input",placeholder:"请输入云区域",attr:{clearable:!0,min:0,type:"number"}}},{label:"网关",key:"gateway",align:"left",attr:{minWidth:"120px"},conditionAttr:{widget:"input",placeholder:"请输入网关",attr:{clearable:!0}}},{label:"DNS服务器",key:"dns",align:"left",attr:{minWidth:"120px"},conditionAttr:{widget:"input",label:"DNS",placeholder:"请输入DNS服务器",attr:{clearable:!0}}},{label:"IP数（可分配/有效数）",key:"ip_count",attr:{minWidth:"160px"},align:"left"},{label:"保留IP数",key:"reserve_ip_count",align:"right"},{label:"添加时间",key:"create_at",align:"left",sortable:!0,attr:{minWidth:"150px"},conditionAttr:{widget:"date-picker",placeholder:"请选择...",attr:{style:{width:"100%"},transfer:!0,clearable:!0,type:"daterange",shortcutClose:!0,useShortcutText:!1,shortcuts:[{text:"今天",value:function(){var t=new Date;return[new Date,t]}},{text:"近7天",value:function(){var t=new Date,e=new Date;return e.setTime(e.getTime()-6048e5),[e,t]}},{text:"近15天",value:function(){var t=new Date,e=new Date;return e.setTime(e.getTime()-1296e6),[e,t]}},{text:"近30天",value:function(){var t=new Date,e=new Date;return e.setTime(e.getTime()-2592e6),[e,t]}}]}}}],modifyVisible:!1,currentItem:{},segmentAttr:[],searchParams:{},customAttrNames:[]}},computed:{getFormWidget:function(){var t=this.formWidgets.concat();return t.pop(),t}},watch:{searchValue:function(t){t||this.onSearch()}},created:function(){var t=this.$store.state.product.tableColumns.ip_net;t.length>0?this.columns=[].concat((0,s.default)(t)):this.columns=this.settingsFields.slice(0,7).concat(this.columns);var e=this.columns.map((function(t){return(0,o.default)({name:t.key,label:t.label},t.conditionAttr)})),a=["ip_count","reserve_ip_count"];this.formWidgets=e.filter((function(t){return!a.includes(t.name)}))},mounted:function(){this.fetchData(),this.getCustomAttr()},methods:{fetchData:function(){var t=this,e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return(0,i.default)(r.default.mark((function a(){var n;return r.default.wrap((function(a){for(;;)switch(a.prev=a.next){case 0:return t.loading=!0,a.prev=1,a.next=4,t.$api.search_ip_net((0,o.default)({},t.searchParams,e,{page:t.pagination.current,page_size:t.pagination.limit,sort:"ascending"===t.sort.order?t.getProp():"-"+t.getProp()}));case 4:(n=a.sent).result?(t.pagination.count=n.data.count,n.data.results.forEach((function(t){t.custom_attr.forEach((function(e){t[e.name]=e.value}))})),t.datas=n.data.results):t._errorMessage(n.message);case 6:return a.prev=6,t.loading=!1,a.finish(6);case 9:case"end":return a.stop()}}),a,t,[[1,,6,9]])})))()},getProp:function(){return"ip_pool_name"===this.sort.prop?"ip_pool__name":this.sort.prop},getCustomAttr:function(){var t=this;return(0,i.default)(r.default.mark((function e(){var a,n,i;return r.default.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,t.$api.searchCustom({type:"tetwork_segment"});case 2:(a=e.sent).result?(t.segmentAttr=a.data.results,a.data.results.forEach((function(e){t.settingsFields.push({label:e.display_name,key:e.name,align:"left",attr:{minWidth:"100px"},conditionAttr:{widget:"input",placeholder:"请输入"+e.display_name,attr:{clearable:!0}}}),t.customAttrNames.push(e.name)})),n=t.columns.map((function(t){return(0,o.default)({name:t.key,label:t.label},t.conditionAttr)})),i=["ip_count","reserve_ip_count"].concat((0,s.default)(t.customAttrNames)),t.formWidgets=n.filter((function(t){return!i.includes(t.name)}))):t.segmentAttr=[];case 4:case"end":return e.stop()}}),e,t)})))()},handlePageChange:function(t){this.pagination.current=t,this.fetchData()},limitChange:function(t){this.pagination.current=1,this.pagination.limit=t,this.fetchData()},onSearch:function(t){this.searchParams={search:t},this.pagination.current=1,this.fetchData({search:t})},handleSettingChange:function(t,e){var a=["ip_count","reserve_ip_count"].concat((0,s.default)(this.customAttrNames));this.formWidgets=t.filter((function(t){return!a.includes(t.name)})),this.$store.commit("setTableColumns",{column:e,key:"ip_net"})},handleAdvancedSearch:function(t){var e=this;(0,n.default)(t).forEach((function(a){"create_at"!==a&&"update_at"!==a||(t[a][0]&&t[a][1]?(t[a+"__gte"]=e.$moment(t[a][0]).format("YYYY-MM-DD HH:mm:ss"),t[a+"__lte"]=e.$moment(t[a][1]).format("YYYY-MM-DD HH:mm:ss"),delete t[a]):delete t[a]),t[a]||delete t[a]})),this.pagination.current=1,this.searchParams=(0,o.default)({},t),this.fetchData((0,o.default)({},t))},handleSortChange:function(t){t.column;var e=t.prop,a=t.order;this.sort.prop=e,this.sort.order=a,this.fetchData()},toModify:function(t){this.modifyVisible=!0,this.currentItem=t?(0,o.default)({},t):{ip_pool:"",formList:[{ip_net:"",bk_cloud_id:"0",gateway:"",dns:"",vlan_id:""}]}},modifyIpNetSuccess:function(t){"add"===t&&(this.pagination.current=1),this.modifyVisible=!1,this.fetchData()},toDelete:function(t){var e=this;return(0,i.default)(r.default.mark((function a(){var n;return r.default.wrap((function(a){for(;;)switch(a.prev=a.next){case 0:return a.next=2,e.$api.delete_ip_net({id:t.id});case 2:(n=a.sent).result?(e._successMessage(n.message),e.fetchData()):e._errorMessage(n.message);case 4:case"end":return a.stop()}}),a,e)})))()},handleVisible:function(){this.$refs.importDialog.showDialog()},toExport:function(){var t=this,e="";(0,n.default)(this.searchParams).forEach((function(a){e=e+"&"+a+"="+t.searchParams[a]}));var a=window.siteUrl+"ip_net/export_excel/?page=1&page_size=-1"+e;window.open(a)}}}},I7S8:function(t,e,a){"use strict";a.d(e,"a",(function(){return n})),a.d(e,"b",(function(){return r}));var n=function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("div",{staticClass:"table—wrapper"},[a("div",{staticClass:"header-table-operation"},[a("search-input",{attrs:{placeholder:"请输入关键字搜索"},on:{search:t.onSearch},model:{value:t.searchValue,callback:function(e){t.searchValue=e},expression:"searchValue"}}),t._v(" "),a("advanced-search",{attrs:{"form-widgets":t.getFormWidget},on:{submit:t.handleAdvancedSearch}}),t._v(" "),a("div",{staticClass:"operation-container"},[a("div",[a("bk-button",{on:{click:function(e){return t.handleVisible()}}},[t._v("\n                    导入\n                ")]),t._v(" "),a("bk-button",{attrs:{title:"添加子网"},on:{click:function(e){return t.toModify()}}},[t._v("\n                    添加子网\n                ")]),t._v(" "),t.datas.length>0?a("bk-button",{attrs:{title:"导出Excel"},on:{click:t.toExport}},[t._v("\n                    导出Excel\n                ")]):t._e()],1)])],1),t._v(" "),a("div",{directives:[{name:"bkloading",rawName:"v-bkloading",value:{isLoading:t.loading,zIndex:10},expression:"{ isLoading: loading, zIndex: 10 }"}]},[a("common-table",{attrs:{data:t.datas,columns:t.columns,"select-column":{visible:!1,fixed:!0},"order-column":{visible:!1,fixed:!1},pagination:t.pagination,"settings-fields":t.settingsFields},on:{handleSettingChange:t.handleSettingChange,"sort-change":t.handleSortChange,"page-change":t.handlePageChange,"page-limit-change":t.limitChange},scopedSlots:t._u([{key:"percent",fn:function(e){return[t._v("\n                "+t._s(e.scope.usedPercent)+"%\n            ")]}},{key:"operation",fn:function(e){return[a("bk-button",{staticClass:"mr10",attrs:{theme:"primary",text:""},on:{click:function(a){return t.toModify(e.scope)}}},[t._v("修改")]),t._v(" "),a("bk-popconfirm",{attrs:{trigger:"click",title:"确认删除该地址池吗？",content:"删除操作无法撤回，请谨慎操作！"},on:{confirm:function(a){return t.toDelete(e.scope)}}},[a("bk-button",{staticClass:"mr10",attrs:{theme:"primary",text:""}},[t._v("删除")])],1)]}}])})],1),t._v(" "),a("edit-address-pool",{attrs:{"current-item":t.currentItem,"segment-attr":t.segmentAttr},on:{ok:t.modifyIpNetSuccess},model:{value:t.modifyVisible,callback:function(e){t.modifyVisible=e},expression:"modifyVisible"}}),t._v(" "),a("import-dialog",{ref:"importDialog",on:{"ok-confirm":t.fetchData}})],1)},r=[]},J5TV:function(t,e,a){"use strict";a.r(e);var n=a("iPaJ"),r=a("v1Nw");for(var i in r)["default"].indexOf(i)<0&&function(t){a.d(e,t,(function(){return r[t]}))}(i);a("fi+f");var o=a("y6gh"),s=Object(o.a)(r.default,n.a,n.b,!1,null,"575c0991",null);e.default=s.exports},"fi+f":function(t,e,a){},g84C:function(t,e,a){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var n=s(a("unDg")),r=s(a("bS4n")),i=s(a("omC7")),o=s(a("uapl"));function s(t){return t&&t.__esModule?t:{default:t}}e.default={name:"address-pool-side-slider",components:{dataSelect:o.default},model:{props:"value",event:"change"},props:{value:{type:Boolean,default:!1},currentItem:{type:Object,default:function(){}},segmentAttr:{type:Array,default:function(){return[]}}},data:function(){return{formData:{ip_pool:"",formList:[{ip_net:"",bk_cloud_id:"",gateway:"",dns:"",vlan_id:""}]},rules:{ip_pool:[{required:!0,message:"必填项",trigger:"blur"}],ip_net:[{required:!0,message:"必填项",trigger:"blur"},{regex:/^(\d{1,2}|1\d\d|2[0-4]\d|25[0-5])\.(\d{1,2}|1\d\d|2[0-4]\d|25[0-5])\.(\d{1,2}|1\d\d|2[0-4]\d|25[0-5])\.(\d{1,2}|1\d\d|2[0-4]\d|25[0-5])\/([1-9]|[1-2][0-9]|3[0-2])$/,message:"请输入正确网段",trigger:"blur"}],bk_cloud_id:[{required:!0,message:"必填项",trigger:"blur"}],gateway:[{required:!0,message:"必填项",trigger:"blur"},{min:3,message:function(t){return t+"不能小于3个字符"},trigger:"blur"},{regex:/^(\d{1,2}|1\d\d|2[0-4]\d|25[0-5])\.(\d{1,2}|1\d\d|2[0-4]\d|25[0-5])\.(\d{1,2}|1\d\d|2[0-4]\d|25[0-5])\.(\d{1,2}|1\d\d|2[0-4]\d|25[0-5])$/,message:"请输入正确的网关",trigger:"blur"}],dns:[{required:!0,message:"必填项",trigger:"blur"},{regex:/^(\d{1,2}|1\d\d|2[0-4]\d|25[0-5])\.(\d{1,2}|1\d\d|2[0-4]\d|25[0-5])\.(\d{1,2}|1\d\d|2[0-4]\d|25[0-5])\.(\d{1,2}|1\d\d|2[0-4]\d|25[0-5])$/,message:"请输入正确的网关",trigger:"blur"}]},status:!1,isConfirm:!1,currentId:"",addressPool:{widget:"data-select",placeholder:"请选择地址池",attr:{remote:!0,filterable:!0,searchable:!0,popperAppendToBody:!1,clearable:!0,url:"searchPool",detailUrl:"poolDetail",initFlag:!0}},segementAttrObj:{}}},computed:{getDisabled:function(){var t=!1;return this.currentId&&(t=!0),t}},watch:{value:{handler:function(t){var e=this;if(this.status=t,!this.status)return!1;this.currentId=this.currentItem.id||"",this.currentId?this.getDetailData():this.formData=JSON.parse((0,i.default)(this.currentItem)),this.$nextTick((function(){e.settingPosition()}))}}},mounted:function(){this.getCustomAttr()},methods:{onVisibleChange:function(){this.$emit("change",this.status)},getCustomAttr:function(){var t=this;if(0===this.segmentAttr.length)return!1;this.customAttrRule(this.segmentAttr),this.segementAttrObj={},this.segmentAttr.forEach((function(e){t.segementAttrObj[e.name]=""}));var e=JSON.parse((0,i.default)(this.formData.formList));this.formData.formList=e.map((function(e){return(0,r.default)({},e,t.segementAttrObj)}))},customAttrRule:function(t){var e=this;t.forEach((function(t){t.required&&(e.rules[t.name]=[{required:!0,message:"必填项",trigger:"blur"}])}))},addParams:function(){var t=this;this.formData.formList.push({ip_net:"",bk_cloud_id:"0",gateway:"",dns:"",vlan_id:""}),this.$nextTick((function(){t.settingPosition()}))},delParams:function(t){var e=this;this.formData.formList.splice(t,1),this.$nextTick((function(){e.settingPosition()}))},submitData:function(){var t=this;this.isConfirm=!0,this.$refs.ipModifyForm.validate().then((function(e){var a=JSON.parse((0,i.default)(t.formData.formList));a.forEach((function(e){var a=[];t.segmentAttr.forEach((function(t){a.push({name:t.name,value:e[t.name]}),delete e[t.name]})),e.custom_attr=a}));var o=a.map((function(e){return(0,r.default)({},e,{ip_pool:t.formData.ip_pool})}));t.currentId?t.commonFetch((0,r.default)({},o[0]),"update_ip_pool"):t.commonFetch({ip_net:[].concat((0,n.default)(o))},"add_ip_pool")}),(function(e){t.isConfirm=!1}))},commonFetch:function(){var t=this,e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},a=arguments[1];this.$api[a]((0,r.default)({},e)).then((function(e){e.result?(t._successMessage(t.currentId?"修改成功":"新增成功"),t.$emit("ok",t.currentId?"edit":"add")):t._errorMessage(e.message)})).finally((function(){t.isConfirm=!1}))},getDetailData:function(){var t={},e=this.currentItem;this.currentItem.custom_attr&&this.currentItem.custom_attr.forEach((function(t){e[t.name]=t.value})),t.formList=[(0,r.default)({},this.currentItem)];var a=this.currentItem,n=a.ip_pool,i=a.ip_pool_name;t.ip_pool=n,t.ip_pool_name=i,this.formData=(0,r.default)({},t),this.addressPool.attr.defaultName=this.formData.ip_pool_name||""}}}},hbeq:function(t,e,a){},iPaJ:function(t,e,a){"use strict";a.d(e,"a",(function(){return n})),a.d(e,"b",(function(){return r}));var n=function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("bk-sideslider",{attrs:{"is-show":t.status,width:540,"quick-close":!1},on:{"update:isShow":function(e){t.status=e},"update:is-show":function(e){t.status=e},shown:t.onVisibleChange,hidden:t.onVisibleChange}},[a("div",{attrs:{slot:"header"},slot:"header"},[t._v("\n        "+t._s(t.currentId?"编辑IP子网":"新增IP子网")+"\n    ")]),t._v(" "),a("div",{staticClass:"slider-content-wrapper",attrs:{slot:"content"},slot:"content"},[a("bk-form",{ref:"ipModifyForm",attrs:{"label-width":170,model:t.formData,rules:t.rules}},[a("p",{staticClass:"title"},[a("span",[t._v("地址池信息")])]),t._v(" "),a("bk-form-item",{attrs:{label:"名称","icon-offset":30,required:!0,property:"ip_pool",rules:t.rules.ip_pool}},[a(t.addressPool.widget,{tag:"component",attrs:{placeholder:t.addressPool.placeholder,"default-value":t.addressPool.defaultValue,attr:t.addressPool.attr},model:{value:t.formData.ip_pool,callback:function(e){t.$set(t.formData,"ip_pool",e)},expression:"formData.ip_pool"}})],1),t._v(" "),a("p",{staticClass:"title"},[a("span",[t._v("子网信息")])]),t._v(" "),t.formData.formList.length>0?a("div",t._l(t.formData.formList,(function(e,n){return a("div",{key:n,staticStyle:{"margin-bottom":"20px"}},[n>=1&&!t.currentId?a("div",{staticClass:"close-icon"},[a("bk-icon",{attrs:{type:"close"},on:{click:function(e){return t.delParams(n)}}})],1):t._e(),t._v(" "),a("bk-form-item",{attrs:{"icon-offset":30,required:!0,label:"网段"+(n+1),property:"formList."+n+".ip_net",rules:t.rules.ip_net}},[a("bk-input",{attrs:{disabled:t.getDisabled,placeholder:"如:192.168.1.0/24"},model:{value:e.ip_net,callback:function(a){t.$set(e,"ip_net",a)},expression:"item.ip_net"}})],1),t._v(" "),a("bk-form-item",{attrs:{"icon-offset":50,label:"云区域",required:!0,property:"formList."+n+".bk_cloud_id",rules:t.rules.bk_cloud_id}},[a("bk-input",{attrs:{type:"number",min:0,placeholder:"默认为0"},model:{value:e.bk_cloud_id,callback:function(a){t.$set(e,"bk_cloud_id",a)},expression:"item.bk_cloud_id"}})],1),t._v(" "),a("bk-form-item",{attrs:{"icon-offset":30,label:"网关",required:!0,property:"formList."+n+".gateway",rules:t.rules.gateway}},[a("bk-input",{attrs:{placeholder:"请输入网关"},model:{value:e.gateway,callback:function(a){t.$set(e,"gateway",a)},expression:"item.gateway"}})],1),t._v(" "),a("bk-form-item",{attrs:{"icon-offset":30,label:"DNS服务器",required:!0,property:"formList."+n+".dns",rules:t.rules.dns}},[a("bk-input",{attrs:{placeholder:"请输入DNS服务器"},model:{value:e.dns,callback:function(a){t.$set(e,"dns",a)},expression:"item.dns"}})],1),t._v(" "),a("bk-form-item",{attrs:{"icon-offset":30,label:"VLAN ID",property:"formList."+n+".vlan_id"}},[a("bk-input",{attrs:{type:"number"},model:{value:e.vlan_id,callback:function(a){t.$set(e,"vlan_id",a)},expression:"item.vlan_id"}})],1),t._v(" "),t._l(t.segmentAttr,(function(r,i){return[a("bk-form-item",{key:i,attrs:{"icon-offset":30,required:r.required,label:r.display_name,rules:t.rules[r.name],property:"formList."+n+"."+r.name}},[a("bk-input",{attrs:{placeholder:"请输入自定义属性值"},model:{value:e[r.name],callback:function(a){t.$set(e,r.name,a)},expression:"item[attr.name]"}})],1)]}))],2)})),0):t._e(),t._v(" "),t.currentId?t._e():a("div",{staticClass:"add-container",on:{click:t.addParams}},[a("bk-icon",{attrs:{type:"plus-circle"}}),t._v(" "),a("span",[t._v("添加子网")])],1)],1)],1),t._v(" "),a("div",{attrs:{slot:"footer"},slot:"footer"},[a("bk-button",{staticStyle:{"margin-left":"24px"},attrs:{"ext-cls":"mr5",theme:"primary",title:"保存",loading:t.isConfirm},on:{click:function(e){return e.stopPropagation(),e.preventDefault(),t.submitData.apply(null,arguments)}}},[t._v("\n            保存\n        ")]),t._v(" "),a("bk-button",{attrs:{"ext-cls":"mr5",theme:"default",title:"取消"},on:{click:function(e){t.status=!1}}},[t._v("\n            取消\n        ")])],1)])},r=[]},lJcR:function(t,e,a){"use strict";a.r(e);var n=a("F0BY"),r=a.n(n);for(var i in n)["default"].indexOf(i)<0&&function(t){a.d(e,t,(function(){return n[t]}))}(i);e.default=r.a},rkma:function(t,e,a){"use strict";a.r(e);var n=a("I7S8"),r=a("lJcR");for(var i in r)["default"].indexOf(i)<0&&function(t){a.d(e,t,(function(){return r[t]}))}(i);a("hbeq");var o=a("y6gh"),s=Object(o.a)(r.default,n.a,n.b,!1,null,"1a1a6b60",null);e.default=s.exports},v1Nw:function(t,e,a){"use strict";a.r(e);var n=a("g84C"),r=a.n(n);for(var i in n)["default"].indexOf(i)<0&&function(t){a.d(e,t,(function(){return n[t]}))}(i);e.default=r.a}}]);
//# sourceMappingURL=8.a3eb82ee8e40724c1b84.js.map
(window.webpackJsonp=window.webpackJsonp||[]).push([[12],{"+f71":function(e,t,r){"use strict";r.r(t);var a=r("qzBw"),i=r("h1Sr");for(var n in i)["default"].indexOf(n)<0&&function(e){r.d(t,e,(function(){return i[e]}))}(n);r("/rrZ");var s=r("y6gh"),o=Object(s.a)(i.default,a.a,a.b,!1,null,"8b1a86d0",null);t.default=o.exports},"/rrZ":function(e,t,r){},Orh4:function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var a=l(r("Asgo")),i=l(r("omC7")),n=l(r("cLjf")),s=l(r("rerW")),o=l(r("hDQ3"));function l(e){return e&&e.__esModule?e:{default:e}}t.default={name:"system-setting",data:function(){return{showUpload:!0,limit:1,file:[{name:"",status:"done",url:window.siteUrl+"sys/get_logo/?random="+Math.random()}],fileParams:null,isEdit:!1,isConfirm:!1,isConfirm2:!1,formData:{ip_net_threshold:"",ip_offline:"",ip_pool_threshold:"",ip_release:"",ip_remind:"",ping_check:"",abnormal_rules:[]},ipPoolThreshold:"",ipNetThreshold:"",files:"",loading:!1,rule:{rule1:!1,rule2:!1,rule3:!1,rule4:!1,rule5:!1,rule6:!1}}},mounted:function(){this.fetchData()},methods:{handleRes:function(e){return!!e.id},fetchData:function(){var e=this;return(0,o.default)(n.default.mark((function t(){var r,a,i,o,l,u,c,f,d,p,h,m,v;return n.default.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return e.loading=!0,t.prev=1,t.next=4,e.$api.searchSys();case 4:if(!(r=t.sent).result){t.next=58;break}a=!0,i=!1,o=void 0,t.prev=9,l=(0,s.default)(r.data.results);case 11:if(a=(u=l.next()).done){t.next=40;break}if("abnormal_rules"!==(c=u.value).key){t.next=36;break}for(e.formData.abnormal_rules=c.extra,f=!0,d=!1,p=void 0,t.prev=18,h=(0,s.default)(e.formData.abnormal_rules);!(f=(m=h.next()).done);f=!0)v=m.value,e.rule[v.rule_code]=v.enabled;t.next=26;break;case 22:t.prev=22,t.t0=t.catch(18),d=!0,p=t.t0;case 26:t.prev=26,t.prev=27,!f&&h.return&&h.return();case 29:if(t.prev=29,!d){t.next=32;break}throw p;case 32:return t.finish(29);case 33:return t.finish(26);case 34:t.next=37;break;case 36:e.formData[c.key]=c.value;case 37:a=!0,t.next=11;break;case 40:t.next=46;break;case 42:t.prev=42,t.t1=t.catch(9),i=!0,o=t.t1;case 46:t.prev=46,t.prev=47,!a&&l.return&&l.return();case 49:if(t.prev=49,!i){t.next=52;break}throw o;case 52:return t.finish(49);case 53:return t.finish(46);case 54:e.ipPoolThreshold=100*e.formData.ip_pool_threshold,e.ipNetThreshold=100*e.formData.ip_net_threshold,t.next=59;break;case 58:e._errorMessage(r.message);case 59:return t.prev=59,e.loading=!1,t.finish(59);case 62:case"end":return t.stop()}}),t,e,[[1,,59,62],[9,42,46,54],[18,22,26,34],[27,,29,33],[47,,49,53]])})))()},submit:function(){var e=this;this.isConfirm=!0;var t,r=!0,a=!1,i=void 0;try{for(var l,u=(0,s.default)(this.formData.abnormal_rules);!(r=(l=u.next()).done);r=!0){var c=l.value;c.enabled=this.rule[c.rule_code]}}catch(e){a=!0,i=e}finally{try{!r&&u.return&&u.return()}finally{if(a)throw i}}this.formData.ip_pool_threshold=this.ipPoolThreshold/100,this.formData.ip_net_threshold=this.ipNetThreshold/100,this.$refs.formData.validate().then((t=(0,o.default)(n.default.mark((function t(r){var a;return n.default.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.prev=0,t.next=3,e.$api.updateSys(e.formData);case 3:(a=t.sent).result?(e._successMessage("更新成功"),e.fetchData(),e.isEdit=!1):e._errorMessage(a.message);case 5:return t.prev=5,e.isConfirm=!1,t.finish(5);case 8:case"end":return t.stop()}}),t,e,[[0,,5,8]])}))),function(e){return t.apply(this,arguments)}))},toEdit:function(){this.isEdit=!0,this.editForm=JSON.parse((0,i.default)(this.formData))},onCancel:function(){this.formData=JSON.parse((0,i.default)(this.editForm)),this.isEdit=!1},fileToBase64:function(e){var t=new FileReader;return t.readAsDataURL(e),new a.default((function(e,r){t.onload=function(t){this.result?e(this.result):r(new Error("转换预览图片失败"))}}))},handleUpload:function(e){var t=this;this.fileParams=e.fileObj.origin,this.fileToBase64(e.fileObj.origin).then((function(e){t.file=[{name:"image.png",status:"done",url:e}],t.showUpload=!1,t.$nextTick((function(){t.showUpload=!0}))}))},uploadLogo:function(){var e=this,t={headers:{"Content-Type":"multipart/form-data"}},r=["png","jpg","svg","jpeg"];if(this.fileParams.size/1024/1024<50){for(var a=!0,i=0;i<r.length;i++){var n=this.fileParams.name.split(".").slice(-1).toString();if(r[i]===n){a=!1,this.fileData=new FormData,this.fileData.append("file",this.fileParams),this.fileData.append("flag",!0),this.isConfirm2=!0,this.$api.updateLogo(this.fileData,t).then((function(t){t.result?(e._successMessage("上传成功"),setTimeout((function(){window.location.reload()}),80)):e._errorMessage(t.message)})).finally((function(){e.isConfirm2=!1}));break}}a&&this.$message.error("请上传支持的文件格式(png,jpg,svg,jpeg)")}else this.$message.error("请上传50M大小以内的文件！")},initLogo:function(){var e,t=this;this.$bkInfo({title:"确定恢复默认吗?",confirmLoading:!0,confirmFn:(e=(0,o.default)(n.default.mark((function e(){var r;return n.default.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,t.$api.updateLogo();case 3:if(!(r=e.sent).result){e.next=10;break}return t._successMessage("恢复成功"),window.location.reload(),e.abrupt("return",!0);case 10:return t._errorMessage(r.message),e.abrupt("return",!0);case 12:e.next=17;break;case 14:return e.prev=14,e.t0=e.catch(0),e.abrupt("return",!1);case 17:case"end":return e.stop()}}),e,t,[[0,14]])}))),function(){return e.apply(this,arguments)})})}}}},h1Sr:function(e,t,r){"use strict";r.r(t);var a=r("Orh4"),i=r.n(a);for(var n in a)["default"].indexOf(n)<0&&function(e){r.d(t,e,(function(){return a[e]}))}(n);t.default=i.a},qzBw:function(e,t,r){"use strict";r.d(t,"a",(function(){return a})),r.d(t,"b",(function(){return i}));var a=function(){var e=this,t=e.$createElement,r=e._self._c||t;return r("div",{staticClass:"wrapper"},[r("div",{staticClass:"content-wrapper logo-set"},[r("h2",[e._v("Logo设置")]),e._v(" "),r("div",[r("div",{staticStyle:{float:"left"}},[e.showUpload?r("bk-upload",{attrs:{files:e.file,theme:"picture","with-credentials":!0,"custom-request":e.handleUpload,"handle-res-code":e.handleRes,multiple:!1,url:"0"}}):e._e()],1),e._v(" "),r("div",{staticStyle:{float:"left","margin-left":"46px",display:"flex","align-items":"center",height:"100px"}},[r("bk-button",{staticStyle:{"margin-right":"8px"},attrs:{theme:"primary",title:"确认上传",loading:e.isConfirm2,disabled:!e.fileParams},on:{click:e.uploadLogo}},[e._v("确认上传\n                ")]),e._v(" "),r("bk-button",{staticStyle:{"margin-right":"8px"},attrs:{theme:"default",title:"恢复默认"},on:{click:e.initLogo}},[e._v("恢复默认\n                ")]),e._v(" "),r("bk-icon",{staticStyle:{color:"#3A84FF"},attrs:{type:"info-circle-shape"}}),e._v(" "),r("span",{staticStyle:{"margin-left":"10px"}},[e._v("仅支持上传png、jpg、svg或jpeg格式的图片、图片宽高比接近1:1最佳")])],1)])]),e._v(" "),r("div",{directives:[{name:"bkloading",rawName:"v-bkloading",value:{isLoading:e.loading,zIndex:10},expression:"{ isLoading: loading, zIndex: 10 }"}],staticClass:"content-wrapper system-set"},[r("h2",[e._v("系统设置")]),e._v(" "),r("bk-form",{ref:"formData",attrs:{"label-width":200,model:e.formData}},[r("bk-form-item",{attrs:{label:"IP在线状态检测周期(天)",desc:"IP地址在线检测的周期设置","desc-type":"icon"}},[r("bk-input",{staticClass:"input-form",attrs:{clearable:!0,type:"number",disabled:!e.isEdit},model:{value:e.formData.ping_check,callback:function(t){e.$set(e.formData,"ping_check",t)},expression:"formData.ping_check"}})],1),e._v(" "),r("bk-form-item",{attrs:{label:"IP异常规则启用",property:"name"}},[r("div",{staticStyle:{display:"flex",transform:"translateX(20px) translateY(-10px)"}},[r("div",{staticStyle:{"margin-right":"20px"}},[r("div",{staticStyle:{"margin-top":"10px"}},[r("bk-checkbox",{attrs:{disabled:!e.isEdit},model:{value:e.rule.rule1,callback:function(t){e.$set(e.rule,"rule1",t)},expression:"rule.rule1"}},[e._v("未分配但在线")])],1),e._v(" "),r("div",{staticStyle:{"margin-top":"10px"}},[r("bk-checkbox",{attrs:{disabled:!e.isEdit},model:{value:e.rule.rule2,callback:function(t){e.$set(e.rule,"rule2",t)},expression:"rule.rule2"}},[e._v("已分配但离线超过时限")])],1),e._v(" "),r("div",{staticStyle:{"margin-top":"10px"}},[r("bk-checkbox",{attrs:{disabled:!e.isEdit},model:{value:e.rule.rule6,callback:function(t){e.$set(e.rule,"rule6",t)},expression:"rule.rule6"}},[e._v("未分配但CMDB中存在")])],1)])])]),e._v(" "),r("bk-form-item",[e.isEdit?e._e():r("bk-button",{staticStyle:{"margin-left":"20px"},attrs:{theme:"primary",title:"修改"},on:{click:e.toEdit}},[e._v("修改\n                ")]),e._v(" "),e.isEdit?r("bk-button",{staticStyle:{"margin-left":"20px"},attrs:{theme:"primary",title:"确认",loading:e.isConfirm},on:{click:function(t){return t.stopPropagation(),t.preventDefault(),e.submit.apply(null,arguments)}}},[e._v("确认\n                ")]):e._e(),e._v(" "),e.isEdit?r("bk-button",{attrs:{title:"取消"},on:{click:e.onCancel}},[e._v("取消")]):e._e()],1)],1)],1)])},i=[]}}]);
//# sourceMappingURL=12.33f4a8d7248f8cb1684b.js.map
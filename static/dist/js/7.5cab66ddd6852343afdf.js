(window.webpackJsonp=window.webpackJsonp||[]).push([[7],{"2m4V":function(e,t,a){},"33MM":function(e,t,a){"use strict";a.d(t,"a",(function(){return n})),a.d(t,"b",(function(){return i}));var n=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",{staticClass:"table—wrapper"},[a("div",{staticClass:"header-table-operation"},[a("search-input",{attrs:{placeholder:"请输入关键字搜索"},on:{search:e.onSearch},model:{value:e.searchValue,callback:function(t){e.searchValue=t},expression:"searchValue"}}),e._v(" "),a("advanced-search",{attrs:{"form-widgets":e.getFormWidget},on:{submit:e.handleAdvancedSearch}}),e._v(" "),a("div",{staticClass:"operation-container"},[a("div",[a("bk-button",{attrs:{title:"新增IP"},on:{click:function(t){return e.$refs.offlineWhiteDialog.showDialog()}}},[e._v("\n                    新增IP\n                ")]),e._v(" "),a("bk-button",{attrs:{title:"批量剔除"},on:{click:e.batchDelete}},[e._v("\n                    批量删除\n                ")]),e._v(" "),e.copyData.length>0?a("bk-button",{attrs:{title:"导出Excel"},on:{click:e.toExport}},[e._v("\n                    导出Excel\n                ")]):e._e()],1)])],1),e._v(" "),a("div",{directives:[{name:"bkloading",rawName:"v-bkloading",value:{isLoading:e.loading,zIndex:10},expression:"{ isLoading: loading, zIndex: 10 }"}]},[a("common-table",{attrs:{data:e.copyData,columns:e.columns,"select-column":{visible:!0,fixed:!0},"order-column":{visible:!1,fixed:!1},"settings-fields":e.settingsFields,pagination:e.pagination},on:{"selection-change":e.selectChange,handleSettingChange:e.handleSettingChange,"page-change":e.handlePageChange,"page-limit-change":e.limitChange},scopedSlots:e._u([{key:"status",fn:function(t){return[a("span",{staticClass:"radius-tip",style:{background:e.statusColorObj[t.scope.allocate_status]}}),e._v("\n                "+e._s(e.statusObj[t.scope.allocate_status])+"\n            ")]}},{key:"operation",fn:function(t){return[a("bk-popconfirm",{attrs:{trigger:"click",title:"确认删除该名单？",content:"删除操作无法撤回，请谨慎操作！"},on:{confirm:function(a){return e.toDelete(t.scope)}}},[a("bk-button",{staticClass:"mr10",attrs:{theme:"primary",text:""}},[e._v("删除")])],1)]}}])})],1),e._v(" "),a("add-offlineWhite",{ref:"offlineWhiteDialog",on:{submit:e.fetchData}})],1)},i=[]},"42GK":function(e,t,a){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n=f(a("rerW")),i=f(a("EPZ6")),r=f(a("cLjf")),o=f(a("hDQ3")),l=f(a("bS4n")),s=f(a("unDg")),c=f(a("DcpZ")),u=f(a("JnIg")),d=f(a("GEkW")),p=f(a("GUh1"));function f(e){return e&&e.__esModule?e:{default:e}}t.default={name:"home",components:{commonTable:u.default,searchInput:c.default,advancedSearch:d.default,addOfflineWhite:p.default},data:function(){return{addIpVisible:!1,searchValue:"",copyData:[],columns:[{label:"操作",key:"operation",width:"60px",scopedSlots:{customRender:"operation"}}],statusColorObj:{2:"#91B6F5",1:"#7ED4B2",4:"#9DB1CE",3:"#E9B76E"},statusObj:{1:"未分配",2:"已分配",3:"待回收",4:"已回收"},selectedRows:[],pagination:{current:1,count:3,limit:10},settingsFields:[{key:"ip",label:"IP地址",disabled:!0,attr:{minWidth:"100px"},conditionAttr:{widget:"input",placeholder:"请输入IP地址",attr:{clearable:!0}}},{key:"ip_pool",label:"地址池名称",attr:{minWidth:"100px"},conditionAttr:{widget:"data-select",label:"地址池",custom:!0,name:"ip_pool",placeholder:"请输入地址池",attr:{clearable:!0,remote:!0,filterable:!0,searchable:!0,popperAppendToBody:!1,url:"searchPool",detailUrl:"poolDetail",initFlag:!0}}},{key:"ip_net",label:"IP子网",attr:{minWidth:"150px"},conditionAttr:{widget:"ip-net-select",placeholder:"请选择子网",label:"子网",custom:!0,name:"ip_net",attr:{nameKey:"ip_pool",remote:!0,filterable:!0,searchable:!0,popperAppendToBody:!1,clearable:!0,url:"search_ip_net",detailUrl:"poolNetDetail",initFlag:!0}}},{key:"bk_cloud_id",label:"云区域",attr:{minWidth:"100px"},conditionAttr:{widget:"input",placeholder:"请输入云区域",attr:{clearable:!0,type:"number",min:0}}},{key:"gateway",label:"网关",attr:{minWidth:"100px"},conditionAttr:{widget:"input",placeholder:"请输入网关",attr:{clearable:!0}}},{key:"dns",label:"DNS服务器",attr:{minWidth:"100px"},conditionAttr:{widget:"input",label:"DNS",placeholder:"请输入DNS服务器",attr:{clearable:!0}}},{key:"allocate_status",label:"分配状态",attr:{minWidth:"100px"},scopedSlots:{customRender:"status"},conditionAttr:{widget:"data-select",custom:!0,placeholder:"请选择相关数据",size:"small",defaultValue:[],attr:{searchable:!1,multiple:!1,popperAppendToBody:!1,clearable:!0,options:[{id:"1",name:"未分配"},{id:"2",name:"已分配"},{id:"3",name:"待回收"},{id:"4",name:"已回收"}]}}},{key:"create_at",label:"添加时间",attr:{minWidth:"160px",showOverflowTooltip:!0},conditionAttr:{widget:"date-picker",placeholder:"请选择...",attr:{style:{width:"100%"},transfer:!0,clearable:!0,type:"daterange",shortcutClose:!0,useShortcutText:!1,shortcuts:[{text:"今天",value:function(){var e=new Date;return[new Date,e]}},{text:"近7天",value:function(){var e=new Date,t=new Date;return t.setTime(t.getTime()-6048e5),[t,e]}},{text:"近15天",value:function(){var e=new Date,t=new Date;return t.setTime(t.getTime()-1296e6),[t,e]}},{text:"近30天",value:function(){var e=new Date,t=new Date;return t.setTime(t.getTime()-2592e6),[t,e]}}]}}}],formWidgets:[],formData:{name:""},loading:!1,searchParams:{}}},computed:{getFormWidget:function(){var e=this.formWidgets.concat();return e.pop(),e}},watch:{searchValue:function(e){e||this.onSearch()}},created:function(){var e=this.$store.state.product.tableColumns.ip_offline;e.length>0?this.columns=[].concat((0,s.default)(e)):this.columns=this.settingsFields.slice(0,7).concat(this.columns);var t=this.columns.map((function(e){return(0,l.default)({name:e.key,label:e.label},e.conditionAttr)}));this.formWidgets=[].concat((0,s.default)(t)),this.fetchData()},methods:{fetchData:function(){var e=this,t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return(0,o.default)(r.default.mark((function a(){var n,i;return r.default.wrap((function(a){for(;;)switch(a.prev=a.next){case 0:return e.loading=!0,a.prev=1,a.next=4,e.$api.search_offlineWhite((0,l.default)({page:e.pagination.current,page_size:e.pagination.limit},e.searchParams,t));case 4:(n=a.sent).result?(i=n.data.results,e.copyData=i.map((function(e){return delete e.ip,(0,l.default)({},e.ip_obj,e)})),e.pagination.count=n.data.count):e._errorMessage(n.message);case 6:return a.prev=6,e.loading=!1,a.finish(6);case 9:case"end":return a.stop()}}),a,e,[[1,,6,9]])})))()},selectChange:function(e){this.selectedRows=e},handlePageChange:function(e){this.pagination.current=e,this.fetchData()},limitChange:function(e){this.pagination.limit=e,this.pagination.current=1,this.fetchData()},handleAdvancedSearch:function(e){var t=this;(0,i.default)(e).forEach((function(a){"create_at"===a&&(e[a][0]&&e[a][1]?(e[a+"__gte"]=t.$moment(e[a][0]).format("YYYY-MM-DD hh:mm:ss"),e[a+"__lte"]=t.$moment(e[a][1]).format("YYYY-MM-DD hh:mm:ss"),delete e[a]):delete e[a]),e[a]||delete e[a]})),this.pagination.current=1,this.searchParams=(0,l.default)({},e),this.fetchData((0,l.default)({},e))},batchDelete:function(){var e=this;return(0,o.default)(r.default.mark((function t(){var a,i,o,l,s,c,u,d;return r.default.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(0!==e.selectedRows.length){t.next=3;break}return e._warnMessage("请先选择要剔除离线白名单的Ip"),t.abrupt("return",!1);case 3:for(a=[],i=!0,o=!1,l=void 0,t.prev=7,s=(0,n.default)(e.selectedRows);!(i=(c=s.next()).done);i=!0)u=c.value,a.push(u.id);t.next=15;break;case 11:t.prev=11,t.t0=t.catch(7),o=!0,l=t.t0;case 15:t.prev=15,t.prev=16,!i&&s.return&&s.return();case 18:if(t.prev=18,!o){t.next=21;break}throw l;case 21:return t.finish(18);case 22:return t.finish(15);case 23:return t.next=25,e.$api.delete_multi_offlineWhite({ip_ids:a});case 25:(d=t.sent).result?(e._successMessage("删除成功"),e.onSearch()):e._errorMessage(d.message);case 27:case"end":return t.stop()}}),t,e,[[7,11,15,23],[16,,18,22]])})))()},toDelete:function(e){var t=this;return(0,o.default)(r.default.mark((function a(){var n;return r.default.wrap((function(a){for(;;)switch(a.prev=a.next){case 0:return a.next=2,t.$api.delete_single_offlineWhite({id:e.id});case 2:(n=a.sent).result?(t._successMessage("删除成功"),t.pagination.current>1&&1===t.copyData.length&&t.pagination.current--,t.fetchData()):t._errorMessage(n.message);case 4:case"end":return a.stop()}}),a,t)})))()},handleSettingChange:function(e,t){this.formWidgets=[].concat((0,s.default)(e)),this.$store.commit("setTableColumns",{column:t,key:"ip_offline"})},onSearch:function(e){this.searchParams={search:e},this.pagination.current=1,this.fetchData({search:e})},toExport:function(){var e=this,t="";(0,i.default)(this.searchParams).forEach((function(a){t=t+"&"+a+"="+e.searchParams[a]}));var a=window.siteUrl+"offline_except/export_excel/?page=1&page_size=-1"+t;window.open(a)}}}},"7Zpv":function(e,t,a){"use strict";a.r(t);var n=a("XhFW"),i=a.n(n);for(var r in n)["default"].indexOf(r)<0&&function(e){a.d(t,e,(function(){return n[e]}))}(r);t.default=i.a},GUh1:function(e,t,a){"use strict";a.r(t);var n=a("WAUH"),i=a("7Zpv");for(var r in i)["default"].indexOf(r)<0&&function(e){a.d(t,e,(function(){return i[e]}))}(r);a("2m4V");var o=a("y6gh"),l=Object(o.a)(i.default,n.a,n.b,!1,null,"4709efd7",null);t.default=l.exports},WAUH:function(e,t,a){"use strict";a.d(t,"a",(function(){return n})),a.d(t,"b",(function(){return i}));var n=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("bk-dialog",{staticClass:"modifyDialog",attrs:{theme:"primary","mask-close":!1,"header-position":"left",title:"新增IP"},model:{value:e.visible,callback:function(t){e.visible=t},expression:"visible"}},[a("bk-form",{ref:"offlineForm",attrs:{"label-width":80,model:e.formData,rules:e.rules}},[a("bk-form-item",{attrs:{label:"地址池",required:!0,property:"apply_ip_pool"}},[a("data-select",{attrs:{disabled:!1,placeholder:"请选择地址池",attr:{remote:!0,filterable:!0,searchable:!0,popperAppendToBody:!1,clearable:!0,url:"searchPool",detailUrl:"poolDetail"}},model:{value:e.formData.apply_ip_pool,callback:function(t){e.$set(e.formData,"apply_ip_pool",t)},expression:"formData.apply_ip_pool"}})],1),e._v(" "),a("bk-form-item",{attrs:{label:"子网",required:!0,property:"ip_net"}},[a("ip-net-select",{attrs:{disabled:!1,placeholder:"请选择子网","form-data":e.formData,attr:{nameKey:"apply_ip_pool",remote:!0,filterable:!0,searchable:!0,popperAppendToBody:!1,clearable:!0,url:"search_ip_net",detailUrl:"poolNetDetail"}},on:{"row-change":e.netSelectChange},model:{value:e.formData.ip_net,callback:function(t){e.$set(e.formData,"ip_net",t)},expression:"formData.ip_net"}})],1),e._v(" "),a("bk-form-item",{attrs:{label:"IP",required:!0,property:"ip_list"}},[a("bk-input",{attrs:{type:"textarea",rows:6,placeholder:"多个不连续IP用英文逗号隔开，连续IP中间用横杠连接，如：1.1.1.1,2.2.2.2,3.3.3.3-3.3.3.10（IP必须在这个子网内，点击确定将进行检测）"},model:{value:e.formData.ip_list,callback:function(t){e.$set(e.formData,"ip_list",t)},expression:"formData.ip_list"}})],1)],1),e._v(" "),a("div",{attrs:{slot:"footer"},slot:"footer"},[a("bk-button",{staticStyle:{"margin-left":"24px"},attrs:{"ext-cls":"mr5",theme:"primary",title:"保存",loading:e.isConfirm},on:{click:function(t){return t.stopPropagation(),t.preventDefault(),e.submitData.apply(null,arguments)}}},[e._v("\n            确定\n        ")]),e._v(" "),a("bk-button",{attrs:{"ext-cls":"mr5",theme:"default",title:"取消"},on:{click:function(t){e.visible=!1}}},[e._v("\n            取消\n        ")])],1)],1)},i=[]},XhFW:function(e,t,a){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n=o(a("omC7")),i=o(a("uapl")),r=o(a("ZZio"));function o(e){return e&&e.__esModule?e:{default:e}}t.default={name:"add-offline-white",components:{dataSelect:i.default,ipNetSelect:r.default},data:function(){return{visible:!1,rules:{apply_ip_pool:[{required:!0,message:"必选项",trigger:"blur"}],ip_net:[{required:!0,message:"必选项",trigger:"blur"}],ip_list:[{required:!0,message:"必选项",trigger:"blur"}]},formData:{},addressPool:{widget:"data-select",placeholder:"请选择地址池",attr:{remote:!0,filterable:!0,searchable:!0,popperAppendToBody:!1,clearable:!0,url:"searchPool",detailUrl:"poolDetail"}},isConfirm:!1}},methods:{showDialog:function(){this.visible=!0,this.formData={ip_pool:"",ip_net:"",ip_list:""},this.$nextTick((function(){setTimeout((function(){var e=document.body.clientHeight,t=document.getElementsByClassName("bk-dialog-content")[0].offsetHeight;if(0===t)return!1;var a=document.getElementsByClassName("bk-dialog")[0];if(t<e){var n=parseInt((e-t)/2);a.style.top=n+"px"}else a.style.top="50px"}),50)}))},submitData:function(){var e=this;this.isConfirm=!0,this.$refs.offlineForm.validate().then((function(t){var a=JSON.parse((0,n.default)(e.formData));e.$api.ip_check({ip_net:a.ip_net,ip_list:a.ip_list.split(",")}).then((function(t){t.result?e.$api.add_offlineWhite({ip_net:a.ip_net,ip_list:a.ip_list.split(",")}).then((function(t){t.result?(e.$bkMessage({theme:"success",message:t.message}),e.$emit("submit"),e.visible=!1):e.$bkMessage({theme:"error",message:t.message})})):e._errorMessage(t.message)})).finally((function(){e.isConfirm=!1}))}),(function(t){e.isConfirm=!1}))},netSelectChange:function(e){var t=this,a=["bk_cloud_id","gateway","dns","vlan_id"];if(e)return a.forEach((function(a){t.formData[a]=e[a]})),!1;a.forEach((function(e){t.formData[e]=""}))}}}},Zgou:function(e,t,a){"use strict";a.r(t);var n=a("42GK"),i=a.n(n);for(var r in n)["default"].indexOf(r)<0&&function(e){a.d(t,e,(function(){return n[e]}))}(r);t.default=i.a},etxf:function(e,t,a){"use strict";a.r(t);var n=a("33MM"),i=a("Zgou");for(var r in i)["default"].indexOf(r)<0&&function(e){a.d(t,e,(function(){return i[e]}))}(r);a("iA4e");var o=a("y6gh"),l=Object(o.a)(i.default,n.a,n.b,!1,null,"53c85bc4",null);t.default=l.exports},iA4e:function(e,t,a){}}]);
//# sourceMappingURL=7.5cab66ddd6852343afdf.js.map
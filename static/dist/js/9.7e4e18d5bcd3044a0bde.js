(window.webpackJsonp=window.webpackJsonp||[]).push([[9],{"7H03":function(e,t,a){"use strict";a.r(t);var n=a("xh9U"),r=a("qALS");for(var i in r)["default"].indexOf(i)<0&&function(e){a.d(t,e,(function(){return r[e]}))}(i);a("r2aW");var o=a("y6gh"),s=Object(o.a)(r.default,n.a,n.b,!1,null,"4e1b5535",null);t.default=s.exports},Q23Q:function(e,t,a){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n=h(a("rerW")),r=h(a("EPZ6")),i=h(a("cLjf")),o=h(a("hDQ3")),s=h(a("bS4n")),l=h(a("unDg")),c=h(a("DcpZ")),d=h(a("JnIg")),u=h(a("GEkW")),p=h(a("lZ0v")),f=h(a("awAS"));function h(e){return e&&e.__esModule?e:{default:e}}t.default={name:"home",components:{commonTable:d.default,searchInput:c.default,advancedSearch:u.default,batchRecycle:p.default,addDistribute:f.default},data:function(){return{copyData:[],columns:[],searchValue:"",loading:!1,statusColorObj:{2:"#91B6F5",1:"#7ED4B2",4:"#9DB1CE",3:"#E9B76E"},statusObj:{1:"未分配",2:"已分配",3:"待回收",4:"已回收"},abnormalObj:{1:"未分配但在线",2:"已分配但离线超过时限",3:"CMDB无此IP记录",4:"CMDB同步属性变动",5:"本地无此IP但CMDB中存在",6:"未分配但CMDB中存在"},selectedRows:[],pagination:{current:1,count:3,limit:10},settingsFields:[{key:"ip",label:"IP地址",disabled:!0,conditionAttr:{widget:"input",placeholder:"请输入IP地址",attr:{clearable:!0}}},{key:"ip_pool",label:"地址池名称",conditionAttr:{widget:"data-select",label:"地址池",custom:!0,name:"ip_pool",placeholder:"请输入地址池",attr:{clearable:!0,remote:!0,filterable:!0,searchable:!0,popperAppendToBody:!1,url:"searchPool",detailUrl:"poolDetail",initFlag:!0}}},{key:"offline_at",label:"离线时间",attr:{minWidth:"160px",showOverflowTooltip:!0},conditionAttr:{widget:"date-picker",placeholder:"请选择...",attr:{style:{width:"100%"},transfer:!0,clearable:!0,type:"daterange",shortcutClose:!0,useShortcutText:!1,shortcuts:[{text:"今天",value:function(){var e=new Date;return[new Date,e]}},{text:"近7天",value:function(){var e=new Date,t=new Date;return t.setTime(t.getTime()-6048e5),[t,e]}},{text:"近15天",value:function(){var e=new Date,t=new Date;return t.setTime(t.getTime()-1296e6),[t,e]}},{text:"近30天",value:function(){var e=new Date,t=new Date;return t.setTime(t.getTime()-2592e6),[t,e]}}]}}},{key:"offline_days",label:"离线天数",conditionAttr:{widget:"input",placeholder:"请输入离线天数",attr:{clearable:!0,type:"number",min:0}}},{key:"gateway",label:"网关",conditionAttr:{widget:"input",placeholder:"请输入网关",attr:{clearable:!0}}},{key:"dns",label:"DNS服务器",conditionAttr:{widget:"input",label:"DNS",placeholder:"请输入DNS服务器",attr:{clearable:!0}}},{key:"allocate_status",label:"分配状态",scopedSlots:{customRender:"status"},conditionAttr:{widget:"data-select",custom:!0,placeholder:"请选择相关数据",size:"small",defaultValue:[],attr:{searchable:!1,multiple:!1,popperAppendToBody:!1,clearable:!0,options:[{id:"1",name:"未分配"},{id:"2",name:"已分配"},{id:"3",name:"待回收"},{id:"4",name:"已回收"}]}}},{key:"online_status",label:"在线状态",scopedSlots:{customRender:"online_status"},conditionAttr:{widget:"data-select",custom:!0,placeholder:"请选择相关数据",size:"small",defaultValue:[],attr:{searchable:!1,multiple:!1,popperAppendToBody:!1,clearable:!0,options:[{id:1,name:"在线"},{id:0,name:"离线"}]}}},{key:"abnormal_code",label:"异常原因",scopedSlots:{customRender:"abnormal_code"},attr:{showOverflowTooltip:!0},conditionAttr:{widget:"data-select",custom:!0,placeholder:"请选择异常原因",size:"small",defaultValue:[],attr:{searchable:!1,multiple:!1,popperAppendToBody:!1,clearable:!0,options:[{id:"1",name:"未分配但在线"},{id:"2",name:"已分配但离线超过时限"},{id:"3",name:"CMDB无此IP记录"},{id:"4",name:"CMDB同步属性变动"},{id:"5",name:"本地无此IP但CMDB中存在"},{id:"6",name:"未分配但CMDB中存在"}]}}}],formWidgets:[],formData:{name:""},searchParams:{},isDropdownShow:!1}},watch:{searchValue:function(e){e||this.onSearch()}},created:function(){this.fetchData();var e=this.$store.state.product.tableColumns.ip_abnormal;e.length>0?this.columns=[].concat((0,l.default)(e)):this.columns=this.settingsFields.slice(0,7).concat(this.columns);var t=this.columns.map((function(e){return(0,s.default)({name:e.key,label:e.label},e.conditionAttr)})),a=["offline_days"];this.formWidgets=t.filter((function(e){return!a.includes(e.name)}))},methods:{fetchData:function(){var e=this,t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return(0,o.default)(i.default.mark((function a(){var n,r;return i.default.wrap((function(a){for(;;)switch(a.prev=a.next){case 0:return e.loading=!0,a.prev=1,a.next=4,e.$api.search_ip_abnormal((0,s.default)({page:e.pagination.current,page_size:e.pagination.limit},e.searchParams,t));case 4:(n=a.sent).result?(r=n.data.results,e.copyData=r.map((function(e){return delete e.ip,(0,s.default)({},e.ip_obj,e)})),e.pagination.count=n.data.count):e._errorMessage(n.message);case 6:return a.prev=6,e.loading=!1,a.finish(6);case 9:case"end":return a.stop()}}),a,e,[[1,,6,9]])})))()},selectChange:function(e){this.selectedRows=e},handlePageChange:function(e){this.pagination.current=e,this.fetchData()},limitChange:function(e){this.pagination.current=1,this.pagination.limit=e,this.fetchData()},onSearch:function(e){this.searchParams={search:e},this.pagination.current=1,this.fetchData({search:e})},handleAdvancedSearch:function(e){var t=this;(0,r.default)(e).forEach((function(a){"offline_at"===a&&(e[a][0]&&e[a][1]?(e["ip__"+a+"__gte"]=t.$moment(e[a][0]).format("YYYY-MM-DD HH:mm:ss"),e["ip__"+a+"__lte"]=t.$moment(e[a][1]).format("YYYY-MM-DD HH:mm:ss"),delete e[a]):delete e[a]),e[a]||0===e[a]||delete e[a]})),this.searchParams=(0,s.default)({},e),this.pagination.current=1,this.fetchData((0,s.default)({},e))},handleRecycle:function(){if(0===this.selectedRows.length)return this._warnMessage("请先选择要回收的IP地址"),!1;this.$refs.batchRecycle.showDialog()},confirmNormal:function(){var e=this;if(0===this.selectedRows.length)return this._warnMessage("请先选择确认为异常的IP"),!1;var t,a=[],r=!0,s=!1,l=void 0;try{for(var c,d=(0,n.default)(this.selectedRows);!(r=(c=d.next()).done);r=!0){var u=c.value;a.push(u.id)}}catch(e){s=!0,l=e}finally{try{!r&&d.return&&d.return()}finally{if(s)throw l}}this.$bkInfo({title:"确认将该异常从清单中清除吗？",subTitle:"如该异常仍存在，将在下一次周期检测时重新纳入异常清单中。",confirmLoading:!0,confirmFn:(t=(0,o.default)(i.default.mark((function t(){var n;return i.default.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.prev=0,t.next=3,e.$api.confirm_ip_abnormal({abnormal_ips:a});case 3:if(!(n=t.sent).result){t.next=10;break}return e._successMessage("确认成功"),e.onSearch(),t.abrupt("return",!0);case 10:return e._errorMessage(n.message),t.abrupt("return",!0);case 12:t.next=17;break;case 14:return t.prev=14,t.t0=t.catch(0),t.abrupt("return",!1);case 17:case"end":return t.stop()}}),t,e,[[0,14]])}))),function(){return t.apply(this,arguments)})})},confirmOffline:function(){var e,t=this;if(0===this.selectedRows.length)return this._warnMessage("请先选择加入离线白名单的IP"),!1;this.$bkInfo({width:500,title:"确认将这些IP加入离线白名单吗？",confirmLoading:!0,confirmFn:(e=(0,o.default)(i.default.mark((function e(){var a,n;return i.default.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,a=t.selectedRows.map((function(e){return e.ip_obj.id})),e.next=4,t.$api.add_offline_except({ip_list:a});case 4:if(!(n=e.sent).result){e.next=11;break}return t._successMessage("加入离线白名单成功"),t.onSearch(),e.abrupt("return",!0);case 11:return t._errorMessage(n.message),e.abrupt("return",!0);case 13:e.next=18;break;case 15:return e.prev=15,e.t0=e.catch(0),e.abrupt("return",!1);case 18:case"end":return e.stop()}}),e,t,[[0,15]])}))),function(){return e.apply(this,arguments)})})},handleVisible:function(e){this.$refs[e].showDialog()},handleSettingChange:function(e,t){var a=["offline_days"];this.formWidgets=e.filter((function(e){return!a.includes(e.name)})),this.$store.commit("setTableColumns",{column:t,key:"ip_abnormal"})},toExport:function(){var e=this,t="";(0,r.default)(this.searchParams).forEach((function(a){t=t+"&"+a+"="+e.searchParams[a]}));var a=window.siteUrl+"ip_abnormal/export_excel/?page=1&page_size=-1"+t;window.open(a)},dropdownShow:function(){this.isDropdownShow=!0},dropdownHide:function(){this.isDropdownShow=!1},triggerHandler:function(){this.$refs.dropdown.hide()}}}},qALS:function(e,t,a){"use strict";a.r(t);var n=a("Q23Q"),r=a.n(n);for(var i in n)["default"].indexOf(i)<0&&function(e){a.d(t,e,(function(){return n[e]}))}(i);t.default=r.a},r2aW:function(e,t,a){},xh9U:function(e,t,a){"use strict";a.d(t,"a",(function(){return n})),a.d(t,"b",(function(){return r}));var n=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",{staticClass:"table—wrapper"},[a("div",{staticClass:"header-table-operation"},[a("search-input",{attrs:{placeholder:"请输入关键字搜索"},on:{search:e.onSearch},model:{value:e.searchValue,callback:function(t){e.searchValue=t},expression:"searchValue"}}),e._v(" "),a("advanced-search",{attrs:{"form-widgets":e.formWidgets},on:{submit:e.handleAdvancedSearch}}),e._v(" "),a("div",{staticClass:"operation-container"},[a("div",[e.copyData.length>0?a("bk-button",{attrs:{title:"导出"},on:{click:e.toExport}},[e._v("\n                    导出Excel\n                ")]):e._e(),e._v(" "),a("bk-dropdown-menu",{ref:"dropdown",attrs:{trigger:"click"},on:{show:e.dropdownShow,hide:e.dropdownHide}},[a("div",{staticClass:"dropdown-trigger-btn",staticStyle:{"padding-left":"19px"},attrs:{slot:"dropdown-trigger"},slot:"dropdown-trigger"},[a("span",[e._v("更多操作")]),e._v(" "),a("i",{class:["bk-icon icon-angle-down",{"icon-flip":e.isDropdownShow}]})]),e._v(" "),a("ul",{staticClass:"bk-dropdown-list",attrs:{slot:"dropdown-content"},slot:"dropdown-content"},[a("li",[a("a",{attrs:{href:"javascript:;"},on:{click:e.confirmNormal}},[e._v("确认异常")])]),e._v(" "),a("li",[a("a",{attrs:{href:"javascript:;"},on:{click:e.confirmOffline}},[e._v("加入离线白名单")])])])])],1)])],1),e._v(" "),a("div",{directives:[{name:"bkloading",rawName:"v-bkloading",value:{isLoading:e.loading,zIndex:10},expression:"{ isLoading: loading, zIndex: 10 }"}]},[a("common-table",{attrs:{data:e.copyData,columns:e.columns,"select-column":{visible:!0,fixed:!0},"order-column":{visible:!1,fixed:!1},"settings-fields":e.settingsFields,pagination:e.pagination},on:{"selection-change":e.selectChange,handleSettingChange:e.handleSettingChange,"page-change":e.handlePageChange,"page-limit-change":e.limitChange},scopedSlots:e._u([{key:"status",fn:function(t){return[a("span",{staticClass:"radius-tip",style:{background:e.statusColorObj[t.scope.allocate_status]}}),e._v("\n                "+e._s(e.statusObj[t.scope.allocate_status])+"\n            ")]}},{key:"online_status",fn:function(t){return[a("span",{style:{color:t.scope.online_status?"#14A568":"#FF5656"}},[e._v("\n                    "+e._s(t.scope.online_status?"在线":"离线")+"\n                ")])]}},{key:"abnormal_code",fn:function(t){return[a("span",[e._v("\n                    "+e._s(e.abnormalObj[t.scope.abnormal_code])+"\n                ")])]}}])},[e._v(" "),e._v(" "),e._v(" "),a("template",{slot:"operation"},[a("bk-button",{staticClass:"mr10",attrs:{theme:"primary",text:""}},[e._v("重置")])],1)],2)],1),e._v(" "),a("batch-recycle",{ref:"batchRecycle",attrs:{selected:e.selectedRows}}),e._v(" "),a("add-distribute",{ref:"distributeDialog"})],1)},r=[]}}]);
//# sourceMappingURL=9.7e4e18d5bcd3044a0bde.js.map